Metadata-Version: 2.4
Name: ebiosrm-generator
Version: 2.0.0
Summary: EBIOS Risk Manager generator - modular version
Author-email: EBIOS Team <team@ebios.example.com>
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: pydantic>=2.0
Requires-Dist: typer>=0.9
Requires-Dist: openpyxl>=3.1
Requires-Dist: pyyaml>=6.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0; extra == "dev"
Requires-Dist: ruff>=0.1; extra == "dev"
Requires-Dist: coverage>=7.0; extra == "dev"

# EBIOS RM Generator v2

GÃ©nÃ©rateur d'Ã©tude de risque EBIOS Risk Manager modulaire et configurable.

## ğŸš€ Installation

```bash
# Installation en mode dÃ©veloppement
pip install -e .

# Ou avec les dÃ©pendances de dÃ©veloppement
pip install -e ".[dev]"
```

## ğŸ“ Structure du projet

```
project_root/
â”œâ”€â”€ config/                 # Configuration et donnÃ©es
â”‚   â”œâ”€â”€ assets.csv          # Actifs valorisÃ©s
â”‚   â”œâ”€â”€ threats.csv         # Menaces et scÃ©narios
â”‚   â””â”€â”€ settings.yaml       # ParamÃ¨tres gÃ©nÃ©raux
â”œâ”€â”€ ebiosrm_core/          # Logique mÃ©tier
â”œâ”€â”€ cli.py                 # Interface en ligne de commande
â””â”€â”€ tests/                 # Tests automatisÃ©s
```

## ğŸ”§ Utilisation

### GÃ©nÃ©ration complÃ¨te

```bash
# Export Excel (par dÃ©faut)
ebiosrm export

# Export JSON
ebiosrm export --fmt json

# RÃ©pertoires personnalisÃ©s
ebiosrm export --cfg ./my_config --out ./my_output --fmt xlsx
```

### Validation des donnÃ©es

```bash
# VÃ©rifier la cohÃ©rence des CSV/YAML
ebiosrm validate --cfg ./config
```

## ğŸ“Š Format des donnÃ©es

### assets.csv
```csv
id,type,label,criticality
A001,Data,Customer Database,Critical
A002,System,Web Server,High
```

### threats.csv
```csv
sr_id,ov_id,strategic_path,operational_steps
SR001,OV001,External Attack,Step1:High,Step2:Medium
SR002,OV002,Internal Fraud,Step1:Low,Step2:High,Step3:Medium
```

### settings.yaml
```yaml
excel_template: templates/ebiosrm_empty.xlsx
severity_scale: [Low, Medium, High, Critical]
likelihood_scale: [One-shot, Occasional, Probable, Systematic]
output_dir: build/
```

## ğŸ§ª Tests

### Tests unitaires
```bash
# ExÃ©cuter tous les tests
pytest

# Tests avec sortie dÃ©taillÃ©e
pytest -v

# Tester un fichier spÃ©cifique
pytest tests/test_loader.py

# Tester une fonction spÃ©cifique
pytest tests/test_loader.py::test_load_assets

# ArrÃªter au premier Ã©chec
pytest -x
```

### Couverture de code
```bash
# Tests avec rapport de couverture
pytest --cov=ebiosrm_core

# Rapport de couverture en HTML
pytest --cov=ebiosrm_core --cov-report=html

# Couverture avec dÃ©tails des lignes manquantes
pytest --cov=ebiosrm_core --cov-report=term-missing
```

### Validation des donnÃ©es
```bash
# VÃ©rifier la cohÃ©rence des CSV/YAML
ebiosrm validate --cfg ./config

# Validation avec diagnostic dÃ©taillÃ©
python debug_threats.py

# Tester le chargement des assets
python -c "from ebiosrm_core.loader import load_assets; print(load_assets('config/assets.csv'))"

# Tester le chargement des threats
python -c "from ebiosrm_core.loader import load_threats; print(load_threats('config/threats.csv'))"
```

### QualitÃ© du code
```bash
# Linting avec ruff
ruff check .

# Formatage automatique
ruff format .

# VÃ©rification du typage (si mypy installÃ©)
mypy ebiosrm_core/

# VÃ©rification de sÃ©curitÃ© (si bandit installÃ©)
bandit -r ebiosrm_core/
```

### Tests d'intÃ©gration
```bash
# Test complet de gÃ©nÃ©ration
ebiosrm export --cfg ./config --out ./test_output --fmt xlsx

# VÃ©rifier que les fichiers sont gÃ©nÃ©rÃ©s
ls -la test_output/

# Test avec diffÃ©rents formats
ebiosrm export --fmt json
ebiosrm export --fmt xlsx
```

### Tests de performance
```bash
# Test avec profiling (si cProfile disponible)
python -m cProfile -o profile.stats cli.py export

# Analyser le profil
python -c "import pstats; p = pstats.Stats('profile.stats'); p.sort_stats('cumulative').print_stats(10)"
```

### Commandes de dÃ©bogage
```bash
# Mode debug avec logs dÃ©taillÃ©s
python -c "import logging; logging.basicConfig(level=logging.DEBUG); from ebiosrm_core.cli import main; main()"

# VÃ©rifier la structure des donnÃ©es chargÃ©es
python -c "
from ebiosrm_core.loader import load_all_data
assets, threats, settings = load_all_data('config')
print(f'Assets: {len(assets)}, Threats: {len(threats)}')
print('Premier asset:', assets[0] if assets else 'Aucun')
"

# Test de la logique de calcul
python -c "
from ebiosrm_core.generator import EbiosRmGenerator
gen = EbiosRmGenerator('config')
risks = gen.generate_risks()
print(f'Risques gÃ©nÃ©rÃ©s: {len(risks)}')
"
```

## ğŸ› DÃ©pannage

### Erreur "keywords must be strings"

Si vous obtenez cette erreur lors de la validation :

```bash
# Diagnostiquer le fichier threats.csv
python debug_threats.py

# VÃ©rifier l'encodage du fichier
file config/threats.csv  # Sur Linux/Mac
```

**Causes communes :**
- Fichier CSV avec BOM (Byte Order Mark)
- CaractÃ¨res non-UTF8 dans les en-tÃªtes
- Colonnes vides ou avec des noms None
- Format CSV incorrect (virgules supplÃ©mentaires)

**Solutions :**
1. Ouvrir le CSV dans un Ã©diteur de texte et vÃ©rifier l'encodage
2. Supprimer le BOM si prÃ©sent
3. VÃ©rifier que toutes les colonnes ont des noms valides
4. Utiliser l'encodage UTF-8 sans BOM

### Commande ebiosrm non trouvÃ©e

```bash
# Ajouter le rÃ©pertoire Python Scripts au PATH
$env:PATH += ";C:\Users\<username>\AppData\Roaming\Python\Python313\Scripts"

# Ou utiliser le module directement
python -m ebiosrm_core.cli validate
```

## ğŸ—ï¸ Architecture

- **models.py**: ModÃ¨les Pydantic (Asset, Threat, Settings)
- **loader.py**: Chargement et validation des donnÃ©es
- **generator.py**: Logique de calcul des risques
- **exporters.py**: Export vers diffÃ©rents formats
- **cli.py**: Interface utilisateur

## ğŸ“ˆ Logique mÃ©tier

1. **GravitÃ©** = Maximum des criticitÃ©s des actifs impactÃ©s
2. **Vraisemblance** = Moyenne pondÃ©rÃ©e des Ã©tapes opÃ©rationnelles
3. **Niveau de risque** = Matrice gravitÃ© Ã— vraisemblance (4Ã—4)

## ğŸ¤ Contribution

1. Fork le projet
2. CrÃ©er une branche feature
3. ImplÃ©menter avec tests
4. Soumettre une pull request
